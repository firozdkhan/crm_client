<div class="row">
  <div class="col-md-9 col-lg-12 col-sm-12 col-xs-12">
    <div id="panel-1" class="panel">
      <app-entry-panel-header [title]="'Add New Purchase'"> </app-entry-panel-header>
      <div class="panel-container  show">
        <div class="panel-content">
          <form [formGroup]="expensesForm" (ngSubmit)="onSubmit()">

            <!-- Invoice No / Date / Description / Bank -->
            <div class="form-row">
              <div class="form-group col-md-3">
                <app-text-input formControlName="invoiceNo" [label]="'Invoice No'" isDisabled="true"></app-text-input>
              </div>

              <div class="form-group col-md-3">
                <app-date-picker formControlName="expenseDate" [label]="'Date'"></app-date-picker>
              </div>

              <div class="form-group col-md-3">
                <app-select-dropdown [data]="userData" formControlName="userId"  [selectedValue]="'2'" [isLabelShow]="true"
                  [label]="'Name'"  (SelectChange)="onBankChange($event)">
                </app-select-dropdown>
              </div>

              <div class="form-group col-md-3">
                <app-select-dropdown [data]="bankData" formControlName="bankId" [isLabelShow]="true"
                  [label]="'Payment Type'" valueField="id" displayField="name" (SelectChange)="onBankChange($event)">
                </app-select-dropdown>
              </div>
            </div>

            <!-- Dynamic Expense Rows -->
            <div formArrayName="expensesReportDetails">
              <table class="table table-bordered mt-4">
                <thead class="thead-dark">
                  <tr>
                    <th>Expense Type</th>
                    <th>Amount</th>
                    <th>Description</th>
                    <th style="width: 120px;">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of expensesReportDetails.controls; let i = index" [formGroupName]="i">
                    <td>
                      <select class="form-control" formControlName="expensesTypeId">
                        <option value='null'>-- Select --</option>
                        <option *ngFor="let product of products" [value]="product.id">
                          {{ product.name }}
                        </option>
                      </select>
                    </td>

                    <td>
                      <input type="number" class="form-control" formControlName="expenseAmount"
                        (input)="calculateTotalAmount()" placeholder={{currencyname}} />
                    </td>
                    <td>
                      <input type="text" class="form-control" formControlName="expensesDescription"
                        placeholder="Description" />
                    </td>
                    <td class="text-center">
                      <button type="button" class="btn btn-sm btn-outline-danger me-1" (click)="removeExpenseRow(i)"
                        [disabled]="expensesReportDetails.length === 1">
                        <i class="fa fa-trash"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-primary" (click)="addExpenseRow()">
                        <i class="fa fa-plus"></i>
                      </button>
                    </td>
                  </tr>

                </tbody>
              </table>
            </div>

            <!-- Total Amount -->
            <div class="form-group col-md-3 mt-3">
              <label>Total Amount</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">{{ currencyname }}</span>
                </div>
                <input type="number" class="form-control" formControlName="totalAmount" readonly />
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-flex mt-4" style="gap:20px">
              <button type="submit" class="btn  " style="background-color: #886ab5; color: white;">
                <strong>Submit</strong>
              </button>

              <!-- Reset Button -->
              <button type="button" class="btn btn-secondary" (click)="resetForm()">
                <strong>Reset</strong>
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Data Grid -->
<div class="col-xl-12 mx-0 px-0">
  <div id="panel-1" class="panel">
    <div class="panel-hdr bg-primary-600 bg-info-gradient">
      <h2>
        Expenese Report <span class="fw-300"><i></i></span>
      </h2>
    </div>
    <div class="panel-container show">
      <div class="panel-content" style="overflow-x: auto;">
        <commongrid *ngIf="expensesss.length > 0" [records]="expensesss" [gridfilter]="gridFilter"
          [SearchText]="txtSearch" [pagesize]="10" (change)="pageChanged($event)" [ShowSorting]="true"
          [PagingType]="'nextprevnumberadvanced'" [ShowSum]="true" [ShowPagesize]="true" [ShowFilter]="false"
          [ShowSNo]="true" (ActionRow)="actionRow($event)">
        </commongrid>

        <app-no-data-found *ngIf="expensesss?.length == 0"></app-no-data-found>
      </div>
    </div>
  </div>
</div>
